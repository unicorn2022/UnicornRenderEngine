[TOC]

# 一、知识点

## 1.1	OpenGL相关

### 1.1.1	渲染测试的顺序

顶点着色器 => 面剔除 => 提前深度测试 => 片段着色器 => 模板测试 => 深度测试

- 使用**提前深度测试**时，片段着色器就不能写入片段的深度值
- **面剔除**：逆时针方向的三角形，视为正向三角形
  - 环绕顺序是在**光栅化**阶段进行的，此时顶点就是**观察者视角**所见的

### 1.1.2	坐标系

> 左手坐标系

观察点`(0,0,5)`，向上方向`(0,1,0)`，欧拉角`yaw=-90°, pitch=0`

- X轴：向右
- Y轴：向上
- Z轴：向屏幕外

### 1.1.3	将方向向量转化为沿XYZ轴旋转的角度

> 将`(1, 0, 0)`沿`X,Y,Z`轴分别旋转`α,β,γ`角度：

旋转矩阵：

<img src="AssetMarkdown/image-20240821165350364.png" alt="image-20240821165350364" style="zoom: 80%;" />

将`(1, 0, 0)`沿`X,Y,Z`轴分别旋转`α,β,γ`角度：
$$
(x,y,z)^T=R_z(γ)·R_y(β)·R_x(α)·(1,0,0)^T
=>\\
\begin{aligned}
x&=\frac{\cos(β+γ)+\cos(β-γ)}{2} = \cos(β)\cos(γ) \\
y&=\frac{\sin(β+γ)-\sin(β-γ)}{2} = \cos(β)\sin(γ) \\
z&=\sin(β)
\end{aligned}
=>\\
\begin{aligned}
α&= 0 \\
β&= arcsin(z) \\
γ&= arctan(y/x)
\end{aligned}
$$

## 1.2	抗锯齿算法

### 1.1.1	SSAA：超采样抗锯齿

> Super Sample Anti-aliasing，以**4x**为例

- 每个像素有4个采样点，需要**运行4次片段着色器**渲染一个像素
  - 顶点数据插值到每个采样点的位置
- 像素的最终颜色：4次渲染结果的平均值

### 1.1.2	MSAA：多重采样抗锯齿

> Multisampling Anti-aliasing，以**4x**为例
>
> - 对每个像素来说，越少的采样点被三角形覆盖，那么它受到这一个三角形的影响就越小

- 每个像素有4个采样点，但**仅运行一次片段着色器**渲染一个像素
  - 顶点数据插值到像素中心
- 渲染结果将会保存在物体覆盖到的每个采样点上
- 像素最终的颜色：所有采样点颜色的平均值

## 1.3	sRGB颜色空间

- 基于**gamma2.2**的颜色空间叫做sRGB颜色空间
- 未经过任何变换的线性颜色空间，为**gamma1**

## 1.4	阴影贴图

### 1.4.1	解决阴影悬浮(Peter Panning)问题

- 渲染深度贴图时，使用**正面剔除**
- 但只对内部不会对外开口的实体物体有效

> 因为我们只需要深度贴图的深度值，对于实体物体无论我们用它们的正面还是背面都没问题。使用背面深度不会有错误，因为阴影在物体内部有错误我们也看不见

<img src="AssetMarkdown/shadow_mapping_culling.png" alt="img" style="zoom:80%;" />

### 1.4.2	PCF 百分比渐进过滤

- 核心思想：从深度贴图中多次采样，每一次采样的纹理坐标都稍有不同
  - 每个独立的样本可能在也可能不再阴影中
  - 所有的次生结果接着结合在一起，进行平均化，我们就得到了柔和阴影